---
layout: post
title: How to encrypt a password
subtitle: ...using bcrypt and nodeJS.
tags: [nodeJS, Javascript, mongoose, mongoDB]
---

## Using bcrypt with NodeJS ##

This is a common piece of code to test the hashing capabilities we can use with bcrypt.
The method genSalt() takes 2 arguments: 
- The  first one is the amount of time that the salt (random characters to hash the original password) is generated, the value per convention is 10 but we can choose any positive integer.
- The second one is a callback where we run a function with err and salt

Example code hash.js
```
const bcrypt = require ('bcrypt');

bcrypt.genSalt(10, (err,salt)=> {
    if (err) return next(err);

    bcrypt.hash('password123', salt, (err,hash)=> {
        if (err) return next(err);
        console.log(hash)
    })
});
```

bcrypt.hash() takes 3 arguments
- The first one will be the password we want to hash.
- The second one is the salt generated by genSalt().
- The callback that contains err and hash (hash is the string that we want to finally store in the database)

## Modifying the user model (user.js) to hash the user's password. ##
First of all we need to run a middleware, the pre() method is here to help!

pre() takes 2 arguments
- The first one is before what?, in our example is before save. 
- The second argument is a function that contains next() in order to continue onto the next process in the code structure.

```
const mongoose = require ('mongoose');
const bcrypt = require('bcrypt');
const SALT_I = 10;
 

const userSchema = mongoose.Schema({
    email: {
        type: String,
        required: true,
        trim: true,
        unique: 1
    },
    password: {
        type: String,
        require: true,
        minlength: 6
    } 
})


userSchema.pre('save',function(next) {
    var user = this;
    bcrypt.genSalt(SALT_I, function (err,salt)=> {
        if (err) return next();
        
        bcrypt.hash(user.password, salt, function (err, hash) {
            if (err) return next(err);
            user.password = hash;
            next();
        })
    })
})

const User = mongoose.model ('User', userSchema  )

module.exports = { User } 
```

Now let's test it running nodemon server.js

## Comparing passwords ##
    

